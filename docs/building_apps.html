

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Building Apps &mdash; TcEx 0.8.29 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Filter" href="data_filter.html" />
    <link rel="prev" title="Batch" href="batch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TcEx
          

          
          </a>

          
            
            
              <div class="version">
                0.8.29
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authorization.html">Authorization (Token / HMAC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Batch</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building Apps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-local-modules">Build Local Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-configuration-file">Using Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-apps-locally">Testing Apps Locally</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile-format">Profile Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile-creation">Profile Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#staging-redis-data">Staging Redis Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-data-file">Example Data File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile-with-data-file">Profile with Data File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-validation">Data Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exit-codes">Exit Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-an-app">Packaging an App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_filter.html">Data Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_tools.html">Development Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="exit.html">Exit</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_json.html">Install JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_tc.html">Message TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="tcex_docs/modules.html">tcex</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Parser / Args</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbook.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxies.html">Proxies</a></li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="results_tc.html">Results TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TcEx</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Building Apps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-apps">
<span id="id1"></span><h1>Building Apps<a class="headerlink" href="#building-apps" title="Permalink to this headline">¶</a></h1>
<div class="section" id="build-local-modules">
<h2>Build Local Modules<a class="headerlink" href="#build-local-modules" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-modules">Running <code class="docutils literal notranslate"><span class="pre">tclib</span></code> will download/install all required Python dependencies defined in the Apps <strong>requirements.txt</strong> file to a local <code class="docutils literal notranslate"><span class="pre">lib_&lt;version&gt;</span></code> directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typically calling <code class="docutils literal notranslate"><span class="pre">tclib</span></code> with no arguments is the most common use case.  If building an App for distribution then using a configuration file to define the lib structure is preferable.  The alternative is to run tclib using each Python version the App should support.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are using <strong>macOS</strong> and have Python installed via Homebrew, there is a <a class="reference external" href="https://stackoverflow.com/questions/24257803/distutilsoptionerror-must-supply-either-home-or-prefix-exec-prefix-not-both">known bug</a> that requires you to create a <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file in the same directory as the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>. The <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file should have the following code at minimum:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">install</span><span class="p">]</span>
<span class="n">prefix</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: tclib <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--app_name APP_NAME<span class="o">]</span> <span class="o">[</span>--app_path APP_PATH<span class="o">]</span>
             <span class="o">[</span>--config CONFIG<span class="o">]</span> <span class="o">[</span>--no_cache_dir<span class="o">]</span> <span class="o">[</span>--tcex_develop<span class="o">]</span>

optional arguments:
  -h, --help           show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --app_name APP_NAME  Fully qualified path of App.
  --app_path APP_PATH  Fully qualified path of App.
  --config CONFIG      Configuration file <span class="k">for</span> gen lib. <span class="o">(</span>Default: tcex.json<span class="o">)</span>
  --no_cache_dir       Do not use pip cache directory.
  --tcex_develop       Replace tcex version <span class="k">in</span> config with github develop branch.
</pre></div>
</div>
</div>
<div class="section" id="using-configuration-file">
<h3>Using Configuration File<a class="headerlink" href="#using-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>By default the <strong>tcex.json</strong> configuration file will be loaded if it exists.  If the configuration includes the <code class="docutils literal notranslate"><span class="pre">lib_versions</span></code> parameter array the <code class="docutils literal notranslate"><span class="pre">tclib</span></code> command will use the values defined in the configuration to build the lib directories.  For ease of management when building multiple Apps the tcex.json file can contain environment vars defining the Python version (e.g., $env.PY36 for <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PY36='3.6.5'</span></code>).</p>
<p><strong>Linux</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">...</span><span class="nx">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;lib_versions&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_2.7.13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.pyenv/versions/2.7.13/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_3.4.6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.pyenv/versions/3.4.6/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_3.5.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.pyenv/versions/3.5.3/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_$env.PY36&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.pyenv/versions/$env.PY36/bin/python&quot;</span>
  <span class="p">}</span>
<span class="p">],</span>
<span class="o">&lt;</span><span class="nx">snipped</span><span class="p">...</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Windows</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">...</span><span class="nx">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;lib_versions&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_2.7.13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~\\AppData\\Local\\Programs\\Python\\Python27\\python.exe&quot;</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="o">:</span> <span class="s2">&quot;lib_3.6.2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="o">:</span> <span class="s2">&quot;~\\AppData\\Local\\Programs\\Python\\Python36\\python.exe&quot;</span>
  <span class="p">}</span>
<span class="p">],</span>
<span class="o">&lt;</span><span class="nx">snipped</span><span class="p">...</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-apps-locally">
<h2>Testing Apps Locally<a class="headerlink" href="#testing-apps-locally" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-testing">Apps are called from the ThreatConnect Platform using Command Line Interface Arguments or CLI Args.  To simulate being called from ThreatConnect the TcEx <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command provides a method for converting a defined JSON structure to CLI Args.  Running <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> will read the <code class="docutils literal notranslate"><span class="pre">tcex.json</span></code> file and parse the <strong>args</strong> section from the <strong>default</strong> profile in the <code class="docutils literal notranslate"><span class="pre">profiles</span></code> parameter array.  To specify a different file the <code class="docutils literal notranslate"><span class="pre">--config</span></code> argument can be passed (e.g. <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">my_config.json</span></code>).  To run a specific profile the <code class="docutils literal notranslate"><span class="pre">--profile</span></code> argument can be passed (<code class="docutils literal notranslate"><span class="pre">--profile</span> <span class="pre">add-indicator</span></code>).  A group of profiles can also be run using the <code class="docutils literal notranslate"><span class="pre">--group</span></code> argument (e.g. <code class="docutils literal notranslate"><span class="pre">--group</span> <span class="pre">run-all</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When testing a single profile (use case) the <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command would be called using that profile.  Before packaging the App calling <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> using a group that will run multiple profiles is typical.</p>
</div>
<div class="section" id="id2">
<h3>Usage<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: tcrun <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--config CONFIG<span class="o">]</span> <span class="o">[</span>--autoclear<span class="o">]</span> <span class="o">[</span>--halt_on_fail<span class="o">]</span>
             <span class="o">[</span>--group GROUP<span class="o">]</span> <span class="o">[</span>--logging_level LOGGING_LEVEL<span class="o">]</span>
             <span class="o">[</span>--profile PROFILE<span class="o">]</span> <span class="o">[</span>--quiet<span class="o">]</span> <span class="o">[</span>--report REPORT<span class="o">]</span>
             <span class="o">[</span>--truncate TRUNCATE<span class="o">]</span> <span class="o">[</span>--unmask<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --config CONFIG       The configuration file. <span class="o">(</span>default: <span class="s2">&quot;tcex.json&quot;</span><span class="o">)</span>
  --autoclear           Clear Redis data before running.
  --halt_on_fail        Halt on any failure.
  --group GROUP         The group of profiles to executed.
  --logging_level LOGGING_LEVEL
                        The logging level.
  --profile PROFILE     The profile to be executed. <span class="o">(</span>default: <span class="s2">&quot;default&quot;</span><span class="o">)</span>
  --quiet               Suppress output.
  --report REPORT       The JSON report filename.
  --truncate TRUNCATE   The length at which to truncate successful validation
                        data <span class="k">in</span> the logs <span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="m">50</span><span class="o">)</span>.
  --unmask              Unmask masked args.
</pre></div>
</div>
</div>
<div class="section" id="profile-format">
<h3>Profile Format<a class="headerlink" href="#profile-format" title="Permalink to this headline">¶</a></h3>
<p>Multiple testing profiles can be defined in the <strong>tcex.json</strong> to help testing coverage.  Each profile should include a unique <strong>profile_name</strong> and a group which allows for running multiple profiles at once.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command provides a feature that allow using environment variables in the <strong>tcex.json</strong> configuration file.  By prefixing the environment variable with <strong>$env.</strong> or <strong>$envs.</strong> the <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command will pull the value from the OS Environment variable. This feature helps facilitate quickly changing values between testing environments and/or user credentials.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To protect credentials in the <strong>tcex.json</strong> configuration file the <strong>$envs.</strong> feature should be used.  This will keep the credentials out of version control and will mask them on command output.  To unmask the credentials temporarily the <code class="docutils literal notranslate"><span class="pre">--unmask</span></code> command can be passed to <code class="docutils literal notranslate"><span class="pre">tcrun</span></code>.</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;profiles&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;api_access_id&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.TC_ACCESS_ID&quot;</span><span class="p">,</span>
      <span class="s2">&quot;api_secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;$envs.TC_SECRET_KEY&quot;</span><span class="p">,</span>
      <span class="s2">&quot;logging&quot;</span><span class="o">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_api_path&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.TC_API_PATH&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_to_api&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_out_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="o">:</span> <span class="s2">&quot;7960ab08-26cb-4140-abb9-9310bb45ac86&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="o">:</span> <span class="s2">&quot;6379&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_host&quot;</span><span class="o">:</span> <span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_port&quot;</span><span class="o">:</span> <span class="s2">&quot;3128&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_external&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_tc&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_temp_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;message&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1234:slack-string!String&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_api_token&quot;</span><span class="o">:</span> <span class="s2">&quot;$envs.SLACK_API_TOKEN&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_recipient&quot;</span><span class="o">:</span> <span class="s2">&quot;@bob&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;run-all&quot;</span><span class="p">],</span>
    <span class="s2">&quot;install_json&quot;</span><span class="o">:</span> <span class="s2">&quot;install.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;profile_name&quot;</span><span class="o">:</span> <span class="s2">&quot;send-slack-message&quot;</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>args</strong> section should contain all the CLI Args your app requires to run. The <strong>groups</strong> section defines which groups this profile should run under and the <strong>profile_name</strong> is the name which can be used to run the profile.  The <strong>quiet</strong> field indicates whether the app should print output.</p>
</div>
</div>
<div class="section" id="profile-creation">
<h3>Profile Creation<a class="headerlink" href="#profile-creation" title="Permalink to this headline">¶</a></h3>
<p>The TcEx framework provides the <code class="docutils literal notranslate"><span class="pre">tcprofile</span></code> command to automatically generate a profile from the install.json file.  The output of the <code class="docutils literal notranslate"><span class="pre">tcprofile</span></code> command will set the exit_code to 0 by default, however testing failure scenarios is also possible by setting the exit code to 1. Some default values will be added to the args section, but any custom inputs will need to be populated with the appropriate data.</p>
<p>For playbook Apps the <code class="docutils literal notranslate"><span class="pre">tcprofile</span></code> command will also create 2 standard validations for each output variable.  The first validation will check to see if the output variable is <strong>null</strong> and the second will ensure the output variables is the correct type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tcprofile</span></code> command can be run multiple times to generate several different profiles with different input and/or output variables.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: tcprofile <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--action <span class="o">{</span>create,delete,replace_validation,update<span class="o">}]</span>
                 <span class="o">[</span>--ij IJ<span class="o">]</span> <span class="o">[</span>--data_file<span class="o">]</span> <span class="o">[</span>--outdir OUTDIR<span class="o">]</span> <span class="o">[</span>--outfile OUTFILE<span class="o">]</span>
                 --profile_name PROFILE_NAME <span class="o">[</span>--redis_hash REDIS_HASH<span class="o">]</span>
                 <span class="o">[</span>--redis_host REDIS_HOST<span class="o">]</span> <span class="o">[</span>--redis_port REDIS_PORT<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --action <span class="o">{</span>create,delete,replace_validation,update<span class="o">}</span>
  --ij IJ               The install.json file name <span class="o">(</span>default: install.json<span class="o">)</span>.
  --data_file           Attempt to build data file templates <span class="k">for</span> the profile.
  --outdir OUTDIR       The *base* output directory containing the
                        data/profiles folder.
  --outfile OUTFILE     The name of the file to write the profile.
  --profile_name PROFILE_NAME
                        The profile name to create, delete, or update.
  --redis_hash REDIS_HASH
                        The redis hash.
  --redis_host REDIS_HOST
                        The redis host.
  --redis_port REDIS_PORT
                        The redis port.
</pre></div>
</div>
</div>
<div class="section" id="staging-redis-data">
<h3>Staging Redis Data<a class="headerlink" href="#staging-redis-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A local instance of Redis must be running to test Playbook Apps locally.</p>
</div>
<p>In order to test using variable inputs the data can be manually added to Redis.  The <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command has functionality to “stage” the data in redis that can be used to simulate an upstream App writing data to Redis.  This staged data can be and added to a single json file or multiple reusable files.  Once the files have been created they should be referenced in the Profile.</p>
</div>
<div class="section" id="example-data-file">
<h3>Example Data File<a class="headerlink" href="#example-data-file" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Data files can contain a single data input or multiple data inputs.  In most cases it better to have separate files so the data can be reused in multiple Profiles.</p>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span>
  <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mf">125</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;threat001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Threat&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:45:42-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/threat/threat.xhtml?threat=125&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mf">124</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;incident001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Incident&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:44:57-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/incident/incident.xhtml?incident=124&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mf">123</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;doc001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:43:54-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/document/document.xhtml?document=123&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mf">122</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;camp001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Campaign&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:40:56-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/campaign/campaign.xhtml?campaign=122&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mf">116</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;adver001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Adversary&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:35:07-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/adversary/adversary.xhtml?adversary=116&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0022:groups!TCEntityArray&quot;</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="profile-with-data-file">
<h3>Profile with Data File<a class="headerlink" href="#profile-with-data-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span>
  <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;api_access_id&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.API_ACCESS_ID&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;$envs.API_SECRET_KEY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logging&quot;</span><span class="o">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_api_path&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.TC_API_PATH&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_log_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_log_to_api&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;tc_out_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_temp_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="o">:</span> <span class="s2">&quot;1860ab08-26cb-4140-abb9-9310bb45ac86&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="o">:</span> <span class="s2">&quot;6379&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_out_variables&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0072:tc.tag.fail_count!String,#App:0072:tc.tag.success_count!String,#App:0072:tc.tag.tags!StringArray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;entity&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0022:groups!TCEntityArray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tag&quot;</span><span class="o">:</span> <span class="s2">&quot;QaTagCreate&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;data_files&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;tcex.d/data/groups.json&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Pass test of create tag.&quot;</span><span class="p">,</span>
  <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
  <span class="s2">&quot;profile_name&quot;</span><span class="o">:</span> <span class="s2">&quot;create-tag-on-groups&quot;</span><span class="p">,</span>
  <span class="s2">&quot;quiet&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;script&quot;</span><span class="o">:</span> <span class="s2">&quot;tc_tag&quot;</span><span class="p">,</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="data-validation">
<h3>Data Validation<a class="headerlink" href="#data-validation" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command provides some basic data validation for output variables.  By defining the <strong>validations</strong> parameter array in the <strong>tcex.json</strong> file the <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command will pull the values from the REDIS DB and perform the provided operator on the data. This action simulates a downstream App reading the data from REDIS.</p>
<p><strong>Example Configuration</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;validations&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.success_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.success_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.fail_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.fail_count!String&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Supported Operators</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;eq&#39;</span> <span class="c1"># equal to</span>
<span class="s1">&#39;ew&#39;</span> <span class="c1"># ends with</span>
<span class="s1">&#39;ge&#39;</span> <span class="c1"># greater than or equal to</span>
<span class="s1">&#39;gt&#39;</span> <span class="c1"># greater than</span>
<span class="s1">&#39;in&#39;</span> <span class="c1"># in array</span>
<span class="s1">&#39;ni&#39;</span> <span class="c1"># not in array</span>
<span class="s1">&#39;it&#39;</span> <span class="c1"># is type (array, binary, entity, string)</span>
<span class="s1">&#39;lt&#39;</span> <span class="c1"># less than</span>
<span class="s1">&#39;le&#39;</span> <span class="c1"># less than or equal to</span>
<span class="s1">&#39;ne&#39;</span> <span class="c1"># not equal</span>
<span class="s1">&#39;sw&#39;</span> <span class="c1"># start with</span>
</pre></div>
</div>
</div>
<div class="section" id="exit-codes">
<h3>Exit Codes<a class="headerlink" href="#exit-codes" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">tcrun</span></code> command can validate the exit code of the App.  This allows for setting up fail scenarios profiles.  All Apps should exit with a valid exit code and handle failures gracefully.  Using the exit_codes parameter you can provide “bad” data to the App and ensure it exits with the proper exit code.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;exit_codes&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mf">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Runtime/Job Apps (non Playbook Apps) valid exit codes are 0, 1, and 3.  For certain profiles you may expect an exit code of 0 for success or 3 for partial success/partial failure.  This can be achieved by adding both status codes to the <strong>exit_codes</strong> parameter array.</p>
</div>
</div>
</div>
<div class="section" id="packaging-an-app">
<h2>Packaging an App<a class="headerlink" href="#packaging-an-app" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-packaging">Running <code class="docutils literal notranslate"><span class="pre">tcpackage</span></code> will build a zip package of your App that can be installed directly in the ThreatConnect Platform.  For Apps packages that contain multiple Apps using separate <strong>install.json</strong> files add the <code class="docutils literal notranslate"><span class="pre">--bundle</span></code> argument to build a bundle.  When using multiple <strong>install.json</strong> files the prefix of the filename is the App name (e.g. MyApp.install.json will have an App name of <strong>MyApp</strong>).  During the build process validation of the <strong>install.json</strong> file will be handled automatically if the <strong>tcex_json_schema.json</strong> schema file is included in the base directory of your App.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typically the <code class="docutils literal notranslate"><span class="pre">tcpackage</span></code> command would be run with no arguments or using the <code class="docutils literal notranslate"><span class="pre">--bundle</span></code> flag for packages with multiple install.json files.</p>
</div>
<div class="section" id="id3">
<h3>Usage<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: tcpackage <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--bundle<span class="o">]</span> <span class="o">[</span>--exclude EXCLUDE<span class="o">]</span> <span class="o">[</span>--config CONFIG<span class="o">]</span>
                 <span class="o">[</span>--install_json INSTALL_JSON<span class="o">]</span> <span class="o">[</span>--outdir OUTDIR<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --bundle              Build a bundle file.
  --exclude EXCLUDE     File and directories to exclude from build.
  --config CONFIG       Build configuration file. <span class="o">(</span>Default: tcex.json<span class="o">)</span>
  --install_json INSTALL_JSON
                        The install.json file name <span class="k">for</span> the App that should be
                        built.
  --outdir OUTDIR       Directory to write the outfile. <span class="o">(</span>Default: target<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-options">
<h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h3>
<p>By default the <code class="docutils literal notranslate"><span class="pre">tcex.json</span></code> file will be loaded by <code class="docutils literal notranslate"><span class="pre">tcpackage</span></code>.  The following is an example of additional configuration that can be provided for the <code class="docutils literal notranslate"><span class="pre">tcpackage</span></code> command.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">..</span><span class="nx">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;package&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;app_name&quot;</span><span class="o">:</span> <span class="s2">&quot;MyApp&quot;</span><span class="p">,</span>
  <span class="s2">&quot;app_version&quot;</span><span class="o">:</span> <span class="s2">&quot;v1.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;bundle&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;excludes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tcex.d&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;outdir&quot;</span><span class="o">:</span> <span class="s2">&quot;target&quot;</span>
<span class="p">},</span>
<span class="o">&lt;</span><span class="nx">snipped</span><span class="p">..</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Multiple Bundles</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">..</span><span class="nx">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;package&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;bundle&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;bundle_name&quot;</span><span class="o">:</span> <span class="s2">&quot;TCPB_-_Palo_Alto&quot;</span><span class="p">,</span>
  <span class="s2">&quot;bundle_packages&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;TCPB_-_My_Bundle_Create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;patterns&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;.*Create.*&quot;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;TCPB_-_My_Bundle_Delete&quot;</span><span class="p">,</span>
    <span class="s2">&quot;patterns&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;.*Delete.*&quot;</span>
    <span class="p">]</span>
  <span class="p">}],</span>
  <span class="s2">&quot;excludes&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tcex.d&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;outdir&quot;</span><span class="o">:</span> <span class="s2">&quot;target&quot;</span>
<span class="p">},</span>
<span class="o">&lt;</span><span class="nx">snipped</span><span class="p">..</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="data_filter.html" class="btn btn-neutral float-right" title="Data Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="batch.html" class="btn btn-neutral float-left" title="Batch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016, ThreatConnect Inc.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>