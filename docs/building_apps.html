

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Apps &mdash; TcEx 0.4.11 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="TcEx 0.4.11 documentation" href="index.html"/>
        <link rel="next" title="Data Filter" href="data_filter.html"/>
        <link rel="prev" title="Authorization (Token / HMAC)" href="authorization.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> TcEx
          

          
          </a>

          
            
            
              <div class="version">
                0.4.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authorization.html">Authorization (Token / HMAC)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building Apps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-local-modules">Build Local Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-an-app">Packaging an App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validate-install-json">Validate install.json</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-app-locally">Testing App Locally</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tcex-json-format">tcex.json Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#staging-redis-data">Staging Redis Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_filter.html">Data Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_tools.html">Development Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="exit.html">Exit</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_json.html">Install JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobs.html">Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_tc.html">Message TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="tcex_docs/modules.html">tcex</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Parser / Args</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbook.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxies.html">Proxies</a></li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="results_tc.html">Results TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">TcEx</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Building Apps</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-apps">
<span id="id1"></span><h1>Building Apps<a class="headerlink" href="#building-apps" title="Permalink to this headline">¶</a></h1>
<p>The ThreatConnect ™ TcEx Framework provides the <a class="reference internal" href="tcex_docs/tcex.tcex_local.html#tcex.tcex_local.TcExLocal" title="tcex.tcex_local.TcExLocal"><code class="xref py py-mod docutils literal"><span class="pre">TcExLocal</span></code></a> module which includes functionality for testing and building apps locally.  The TcEx Framework ships with the Python script <code class="docutils literal"><span class="pre">app.py</span></code> which can be copied to the base of you App for an easy interface to the TcExLocal module.</p>
<p>The <code class="docutils literal"><span class="pre">__main__.py</span></code> file provided with the TcEx framework should also be copied to your App base directory.  This script will be called when the ThreatConnect Platform executes the App.</p>
<div class="section" id="build-local-modules">
<h2>Build Local Modules<a class="headerlink" href="#build-local-modules" title="Permalink to this headline">¶</a></h2>
<p>Running <code class="docutils literal"><span class="pre">./app.py</span> <span class="pre">--lib</span></code> will download/install all required Python dependencies defined in the App setup.py file to a local <code class="docutils literal"><span class="pre">lib_&lt;version&gt;</span></code> directory.</p>
</div>
<div class="section" id="packaging-an-app">
<h2>Packaging an App<a class="headerlink" href="#packaging-an-app" title="Permalink to this headline">¶</a></h2>
<p>Running <code class="docutils literal"><span class="pre">./app.py</span> <span class="pre">--package</span></code> will build a zip package of your App that can be installed directly in the ThreatConnect Platform.  For Apps packages that contain multiple Apps using separate <strong>install.json</strong> files add the <code class="docutils literal"><span class="pre">--collection</span></code> argument to build a collection.  An optional argument of <code class="docutils literal"><span class="pre">--zip_out</span></code> can be used to specify where the zip files is written.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method only builds the Python dependencies for the version of Python that is used to run the <code class="docutils literal"><span class="pre">./app.py</span></code> script. To build for multiple versions of Python the <code class="docutils literal"><span class="pre">./app.py</span> <span class="pre">--package</span></code> must be run multiple times for each supported Python version (e.g 2.7.12, 3.4.5, 3.5.2, 3.6.0).  Building the App for all required Python versions is possible using an external tool like Maven.</p>
</div>
</div>
<div class="section" id="validate-install-json">
<h2>Validate install.json<a class="headerlink" href="#validate-install-json" title="Permalink to this headline">¶</a></h2>
<p>This <a class="reference internal" href="install_json.html#install-json"><span class="std std-ref">Install JSON</span></a> file defines the properties and inputs of the App.  Running <code class="docutils literal"><span class="pre">./app.py</span> <span class="pre">--validate</span></code> will validate the install.json file to ensure basic syntax and format.  If validating an install.json in a collection the <code class="docutils literal"><span class="pre">--install_json</span></code> argument can be passed with the name of the file to be validated.</p>
</div>
<div class="section" id="testing-app-locally">
<h2>Testing App Locally<a class="headerlink" href="#testing-app-locally" title="Permalink to this headline">¶</a></h2>
<p>Apps are called from the ThreatConnect Platform using Command Line Interface Arguments or CLI Args.  To simulate being called from ThreatConnect the TcExLocal module provides a method for converting a JSON file to CLI Args.  Running <code class="docutils literal"><span class="pre">./app.py</span> <span class="pre">--run</span></code> will read the <code class="docutils literal"><span class="pre">tcex.json</span></code> file and parse the <strong>default</strong> profile.  To specify a different file the <code class="docutils literal"><span class="pre">--config</span></code> argument can be passed (e.g. <code class="docutils literal"><span class="pre">--config</span> <span class="pre">my_config.json</span></code>).  To run a specific profile the <code class="docutils literal"><span class="pre">--profile</span></code> argument can be passed (<code class="docutils literal"><span class="pre">--profile</span> <span class="pre">add-indicator</span></code>).  A group of commands can also be run using the <code class="docutils literal"><span class="pre">--group</span></code> argument (e.g. <code class="docutils literal"><span class="pre">--group</span> <span class="pre">use-sample-data</span></code>).</p>
<div class="section" id="tcex-json-format">
<h3>tcex.json Format<a class="headerlink" href="#tcex-json-format" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;profiles&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;api_access_id&quot;</span><span class="o">:</span> <span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
      <span class="s2">&quot;api_secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz0987654321&quot;</span><span class="p">,</span>
      <span class="s2">&quot;logging&quot;</span><span class="o">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
      <span class="s2">&quot;message&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1234:slack-string!String&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_api_token&quot;</span><span class="o">:</span> <span class="s2">&quot;01234abcde&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_recipient&quot;</span><span class="o">:</span> <span class="s2">&quot;@bob&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_api_path&quot;</span><span class="o">:</span> <span class="s2">&quot;https://api.threatconnect.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_to_api&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_out_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="o">:</span> <span class="s2">&quot;7960ab08-26cb-4140-abb9-9310bb45ac86&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="o">:</span> <span class="s2">&quot;6379&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_host&quot;</span><span class="o">:</span> <span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_port&quot;</span><span class="o">:</span> <span class="s2">&quot;3128&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_external&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_tc&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_temp_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;full-functionality&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;profile_name&quot;</span><span class="o">:</span> <span class="s2">&quot;send-slack-message&quot;</span><span class="p">,</span>
    <span class="s2">&quot;script&quot;</span><span class="o">:</span> <span class="s2">&quot;slack&quot;</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>args</strong> section should contain all the CLI Args your app requires to run. The <strong>group</strong> section defines which group this profile should run under and the <strong>profile_name</strong> is the name which can be used to run the profile.  The <strong>script</strong> field is the name of the actual Python script to run minus the <strong>.py</strong> extension.  The <strong>quiet</strong> field indicates whether the app should print output.</p>
</div>
</div>
<div class="section" id="staging-redis-data">
<h3>Staging Redis Data<a class="headerlink" href="#staging-redis-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A local instance of Redis must be running to test locally.</p>
</div>
<p>In order to test using variable inputs the data must be manually added to Redis.  The code below will simulate an upstream App writing data to Redis.  This code can be saved to a script <code class="docutils literal"><span class="pre">redis-create.py</span></code> and added to the <code class="docutils literal"><span class="pre">tcex.json</span></code> as a profile.  By doing this the local Testing enviroment can be simulate a piece of a running playbook.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; standard &quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="sd">&quot;&quot;&quot; third party &quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot; custom &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">tcex</span> <span class="kn">import</span> <span class="n">TcEx</span>
<span class="n">tcex</span> <span class="o">=</span> <span class="n">TcEx</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

    <span class="c1"># String variable</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="s1">&#39;#App:1234:a-string!String&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;a-string&#39;</span>
    <span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="c1"># String Array</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="s1">&#39;#App:1234:a-string-array!StringArray&#39;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">]</span>
    <span class="n">tcex</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data_filter.html" class="btn btn-neutral float-right" title="Data Filter" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="authorization.html" class="btn btn-neutral" title="Authorization (Token / HMAC)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, ThreatConnect Inc.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>