

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Building Apps &mdash; TcEx 0.9.0 documentation</title>

















    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />



    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />



        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="TcEx 0.9.0 documentation" href="index.html"/>
        <link rel="next" title="Data Filter" href="data_filter.html"/>
        <link rel="prev" title="Batch" href="batch.html"/>


  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">


  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="index.html" class="icon icon-home"> TcEx



          </a>




              <div class="version">
                0.9.0
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="authorization.html">Authorization (Token / HMAC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Batch</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building Apps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#command-summary">Command Summary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tcinit">tcinit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tclib">tclib</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcprofile">tcprofile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcrun">tcrun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcpackage">tcpackage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initializing-an-app">Initializing an App</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#more-details">More Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-lib-directory">Building the “lib” Directory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">More Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-testing-profile-optional">Creating a Testing Profile (Optional)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#local-testing-optional">Local Testing (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#packaging-an-app">Packaging an App</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#app-templates-tcinit">App Templates (tcinit)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#common-usage">Common Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#job-app-templates">Job App Templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#job-job">Job (job)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#job-ingress-job-ingress">Job Ingress (job_ingress)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#playbook-app-templates">Playbook App Templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#playbook-playbook">Playbook (playbook)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#playbook-action-playbook-action">Playbook Action (playbook_action)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#playbook-utility-playbook-utility">Playbook Utility (playbook_utility)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-dependencies-tclib">Build Dependencies (tclib)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-apps-dependencies">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Common Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-configuration-file">Using Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-test-profiles-tcprofile">Creating Test Profiles (tcprofile)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Common Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#profile-format">Profile Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#args-app">args.app</a></li>
<li class="toctree-l4"><a class="reference internal" href="#args-default">args.default</a></li>
<li class="toctree-l4"><a class="reference internal" href="#autoclear">autoclear</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-files">data_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#description">description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exit-codes">exit_codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#groups">groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-json">install_json</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profile-name">profile_name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quiet">quiet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validations">validations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#staging-redis-data">Staging Redis Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Data Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-validation">Data Validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#supported-operators">Supported Operators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-test-profiles-tcrun">Running Test Profiles (tcrun)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Profile Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile-creation">Profile Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Staging Redis Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-data-file">Example Data File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#profile-with-data-file">Profile with Data File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Data Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Exit Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-an-app-tcpackage">Packaging an App (tcpackage)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#app-directory-structure">App Directory Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15">Initializing an App</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_filter.html">Data Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="exit.html">Exit</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_json.html">Install JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_tc.html">Message TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="tcex_docs/modules.html">tcex</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Parser / Args</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbook.html">Playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxies.html">Proxies</a></li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="results_tc.html">Results TC</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TcEx</a>

      </nav>



      <div class="wy-nav-content">
        <div class="rst-content">
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="index.html">Docs</a> &raquo;</li>

      <li>Building Apps</li>


      <li class="wy-breadcrumbs-aside">



      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <div class="section" id="building-apps">
<span id="id1"></span><h1>Building Apps<a class="headerlink" href="#building-apps" title="Permalink to this headline">¶</a></h1>
<p>The ThreatConnect® TcEx Framework provides a full features SDK as well CLI tools to enable developer to rapidly develop Apps.  The following CLI tools enable the developer to walk through each step of the development process.</p>
<div class="section" id="command-summary">
<h2>Command Summary<a class="headerlink" href="#command-summary" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tcinit">
<span id="building-apps-commands"></span><h3>tcinit<a class="headerlink" href="#tcinit" title="Permalink to this headline">¶</a></h3>
<p>This CLI tool provides a simple interface to kick start a new project from a template and to keep framework files up to date.  There are several template that supported specific use cases. Most templates are working Apps that can be easily modified to the developers use case.</p>
</div>
<div class="section" id="tclib">
<h3>tclib<a class="headerlink" href="#tclib" title="Permalink to this headline">¶</a></h3>
<p>This CLI tool provides a simple interface to download required Python modules in a self contained folder in the project directory.  This “lib” directory allows all dependencies to be bundled within the App.</p>
</div>
<div class="section" id="tcprofile">
<h3>tcprofile<a class="headerlink" href="#tcprofile" title="Permalink to this headline">¶</a></h3>
<p>This CLI tool provides a simple interface to create testing profiles.  The profiles can be used to perform local testing of the App before deploying to ThreatConnect.  Multiple profiles can be create and grouped to allow testing of different data inputs and outputs.</p>
</div>
<div class="section" id="tcrun">
<h3>tcrun<a class="headerlink" href="#tcrun" title="Permalink to this headline">¶</a></h3>
<p>This CLI tool provides a simple interface to run the App locally using the profiles created using the <code class="docutils literal"><span class="pre">tcprofile</span></code> command.  If the profile has validation rules defined the <code class="docutils literal"><span class="pre">tcrun</span></code> command will validate the output variables as defined in the validation rules.</p>
</div>
<div class="section" id="tcpackage">
<h3>tcpackage<a class="headerlink" href="#tcpackage" title="Permalink to this headline">¶</a></h3>
<p>This CLI tool provides a simple interface to package the App so that it can be easily deployed to the ThreatConnect Platform.</p>
</div>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-quickstart">The following steps are written for development on a OSX or Linux system.  Development on a Windows system is supported and should follow similar steps. Prior to proceeding Python must be installed and if preferred a Python virtual environment should be configured. For local testing a Redis server also must be installed and running. The steps to install Python, Redis, and configure a virtual environment are outside the scope of this document.</p>
<p>This quickstart guide will walk through each step to create a working App. It will initialize a fully functioning App. Adding custom code/logic is not covered in this quickstart guide.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This guide assumes that the workstation and ThreatConnect instance have the same version of Python installed. Writing Apps that support multiple versions of Python is supported but not covered in the quickstart guide.</p>
</div>
<div class="section" id="initializing-an-app">
<h3>Initializing an App<a class="headerlink" href="#initializing-an-app" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tcex</span>
<span class="n">mkdir</span> <span class="n">TCPB_</span><span class="o">-</span><span class="n">_JsonPretty</span>
<span class="n">cd</span> <span class="n">TCPB_</span><span class="o">-</span><span class="n">_JsonPretty</span>
<span class="n">tcinit</span> <span class="o">--</span><span class="n">action</span> <span class="n">create</span> <span class="o">--</span><span class="n">template</span> <span class="n">playbook_utility</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The prefix of <strong>TCPB_-_</strong> (ThreatConnect PlayBook) is optional. However, it’s a helpful naming convention to distinguish PlayBook Apps from Job Apps.</p>
</div>
<p>After running the <code class="docutils literal"><span class="pre">tcinit</span></code> command the App directory/file structure will be autogenerated. The <strong>playbook_utility</strong> template is a working App so there is no need to change any of the files.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information on the App directory structure read the <a class="reference internal" href="#building-apps-structure"><span class="std std-ref">App Structure</span></a> section of the guide.</p>
</div>
<div class="section" id="more-details">
<h4>More Details<a class="headerlink" href="#more-details" title="Permalink to this headline">¶</a></h4>
<p>For more details on the <code class="docutils literal"><span class="pre">tcinit</span></code> command see <a class="reference internal" href="#app-templates-tcinit">App Templates (tcinit)</a>.</p>
</div>
</div>
<div class="section" id="building-the-lib-directory">
<h3>Building the “lib” Directory<a class="headerlink" href="#building-the-lib-directory" title="Permalink to this headline">¶</a></h3>
<p>At a minimum all Apps require the <code class="docutils literal"><span class="pre">tcex</span></code> Python package.  If other Python packages are required the package name should be added to the requirements.txt file in the project directory. For this quickstart guide no additional packages are required.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tclib</span>
</pre></div>
</div>
<p>After running the <code class="docutils literal"><span class="pre">tclib</span></code> command a “lib_&lt;Python version&gt;” (e.g., lib_3.6.7) directory will be in the project directory. This directory will contain all Python packages defined in requirements.txt and any sub-dependencies.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This version of the lib directory should closely match the version of Python on the ThreatConnect server.  Difference in micro versions (e.g., Python version 3.6.5 / lib_3.6.7) are acceptable.</p>
</div>
<div class="section" id="id2">
<h4>More Details<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>For more details on the <code class="docutils literal"><span class="pre">tcinit</span></code> command see <a class="reference internal" href="#build-dependencies-tclib">Build Dependencies (tclib)</a>.</p>
</div>
</div>
<div class="section" id="creating-a-testing-profile-optional">
<h3>Creating a Testing Profile (Optional)<a class="headerlink" href="#creating-a-testing-profile-optional" title="Permalink to this headline">¶</a></h3>
<p>This section will go over the steps to setup a test profile to facilitate the testing of the App outside of the ThreatConnect platform. Creating testing profiles is not required to build and deploy and App. However, this feature provides a faster development cycle as compared to uploading the App to the ThreatConnect platform after each change.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcprofile</span> <span class="o">--</span><span class="n">name</span> <span class="n">simple_data</span>
</pre></div>
</div>
<p>After running the <code class="docutils literal"><span class="pre">tcprofile</span></code> a the directory <strong>tcex.d</strong> will be created in the project directory.  The <strong>tcex.d</strong> directory will have the structure displayed below. New testing profiles can be added to existing file or new files can be created.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>tcex.d
├── data
└── profiles
    └── simple_data.json
</pre></div>
</div>
<p>Now that <em>simple_data</em> profile has been created, testing value needs to be added to the <strong>simple_data.json</strong> file.  This template has 3 inputs defined in the <strong>install.json</strong> configuration files.  The <code class="docutils literal"><span class="pre">tcprofile</span></code> command will populate the values for the inputs if there is a <strong>default</strong> value defined in the <strong>install.json</strong> file.  Update the <strong>simple_data.json</strong> file with the values shown in the following code snippet.</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;...</span> <span class="n">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;json_data&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">four</span><span class="se">\&quot;</span><span class="s2">:4, </span><span class="se">\&quot;</span><span class="s2">one</span><span class="se">\&quot;</span><span class="s2">: 1, </span><span class="se">\&quot;</span><span class="s2">two</span><span class="se">\&quot;</span><span class="s2">: 2, </span><span class="se">\&quot;</span><span class="s2">three</span><span class="se">\&quot;</span><span class="s2">: 3}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sort_keys&quot;</span><span class="p">:</span> <span class="n">true</span>
  <span class="p">},</span>
<span class="o">&lt;</span><span class="n">snipped</span> <span class="o">...&gt;</span>
</pre></div>
</div>
<div class="section" id="environment-variables">
<h4>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h4>
<p>An important part of local testing is setting up the appropriate environmental variables.  In each profile the <code class="docutils literal"><span class="pre">args.default</span></code> section has all the default args that will be provided to every App by the ThreatConnect Platform during execution. The values for these args can be entered directly into the configuration file, however to keep sensitive data out of VCS systems the use of environment variables is employed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This list of environment variables can be found by running <code class="docutils literal"><span class="pre">tcprofile</span> <span class="pre">-h</span></code>.</p>
</div>
<p>Update the values for each variable and add to the local environment (e.g., ~/.bashrc or ~/.bash_profile). Once done the environment file will need to be sourced once or the shell restarted before the values are available (e.g., source ~/.bashrc).</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span># ThreatConnect API Credential and URL
export API_DEFAULT_ORG=MyOrg
export API_ACCESS_ID=1234
export API_SECRET_KEY=abc123
export TC_API_PATH=https://maclaren.pub/api

# API Token can be supplied optionally, but must be updated frequently.
export TC_TOKEN=123-abc-456-def

# Proxy settings are optional
export TC_PROXY_HOST=10.10.10.10
export TC_PROXY_PORT=3128
export TC_PROXY_USERNAME=robin
export TC_PROXY_PASSWORD=sparkles

# The Redis IP/Host and Port
export DB_PATH=localhost
export DB_PORT=6379
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">To test that the values are available run <code class="docutils literal"><span class="pre">echo</span> <span class="pre">$API_ACCESS_ID</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="local-testing-optional">
<h3>Local Testing (Optional)<a class="headerlink" href="#local-testing-optional" title="Permalink to this headline">¶</a></h3>
<p>This section will go over how to run the test profile created in the <a class="reference internal" href="#creating-a-testing-profile-optional">Creating a Testing Profile (Optional)</a> step.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcrun</span> <span class="o">--</span><span class="n">profile</span> <span class="n">simple_data</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tcrun</span></code> command logs informational messages to the screen about what actions are taken and the results.  At the bottom of the output a Report is displayed with the results of the testing profile.  If the execution “Passed” and the 2 validations passed then the App profile successfully ran.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">Report</span><span class="p">:</span>
                                                 <span class="n">Validations</span>
<span class="n">Profile</span><span class="p">:</span>                <span class="n">Execution</span><span class="p">:</span>               <span class="n">Passed</span><span class="p">:</span>   <span class="n">Failed</span><span class="p">:</span>
<span class="n">simple_data</span>             <span class="n">Passed</span>                   <span class="mi">2</span>         <span class="mi">0</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tcrun</span></code> command log to the <strong>log/run.log</strong> file.  This log file is structured to help quickly discover errors with validation rules.  Any validation failure will be logged at <strong>ERROR</strong> level.</p>
</div>
<div class="section" id="packaging-an-app">
<h3>Packaging an App<a class="headerlink" href="#packaging-an-app" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcpackage</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tcpackage</span></code> command will package all relevant files in the project directory into a “<strong>.tcx</strong>” file that can be uploaded to the ThreatConnect Platform. By default the package will be created in the <strong>target</strong> directory in the project directory.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The <code class="docutils literal"><span class="pre">tclib</span></code> command must be successfully ran before packaging an App. Otherwise the App will be missing any dependencies and may not function properly.</p>
</div>
</div>
</div>
<div class="section" id="app-templates-tcinit">
<h2>App Templates (tcinit)<a class="headerlink" href="#app-templates-tcinit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="summary">
<span id="building-apps-templates"></span><h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">tcinit</span></code> CLI tool provides a simple interface to kick start a new project from a template and to keep framework files updated.  There are several template that supported specific use cases. Most templates are working Apps that can be easily modified to the developers use case.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>To get the latest usage and template choices for <code class="docutils literal"><span class="pre">tcinit</span></code> run <code class="docutils literal"><span class="pre">tcinit</span> <span class="pre">-h</span></code>.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tcinit</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">branch</span> <span class="p">{</span><span class="n">master</span><span class="p">,</span><span class="n">develop</span><span class="p">}]</span>
              <span class="p">[</span><span class="o">--</span><span class="n">action</span> <span class="p">{</span><span class="n">create</span><span class="p">,</span><span class="n">update</span><span class="p">,</span><span class="n">migrate</span><span class="p">}]</span> <span class="o">--</span><span class="n">template</span>
              <span class="p">{</span><span class="n">job</span><span class="p">,</span><span class="n">job_batch</span><span class="p">,</span><span class="n">playbook</span><span class="p">,</span><span class="n">playbook_actions</span><span class="p">,</span><span class="n">playbook_utility</span><span class="p">}</span>
              <span class="p">[</span><span class="o">--</span><span class="n">force</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">branch</span> <span class="p">{</span><span class="n">master</span><span class="p">,</span><span class="n">develop</span><span class="p">}</span>
                        <span class="n">git</span> <span class="n">branch</span><span class="o">.</span>
  <span class="o">--</span><span class="n">action</span> <span class="p">{</span><span class="n">create</span><span class="p">,</span><span class="n">update</span><span class="p">,</span><span class="n">migrate</span><span class="p">}</span>
                        <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">create</span><span class="p">)</span> <span class="n">Choose</span> <span class="s2">&quot;create&quot;</span> <span class="n">to</span> <span class="n">initialize</span> <span class="n">a</span> <span class="n">new</span>
                        <span class="n">App</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span> <span class="n">to</span> <span class="n">download</span> <span class="n">updates</span> <span class="n">to</span> <span class="n">App</span> <span class="n">framework</span>
                        <span class="n">files</span><span class="p">,</span> <span class="ow">and</span> <span class="s2">&quot;migrate&quot;</span> <span class="n">to</span> <span class="n">update</span> <span class="n">a</span> <span class="n">non</span> <span class="n">App</span> <span class="n">Builder</span>
                        <span class="n">compliant</span> <span class="n">App</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="n">standard</span> <span class="n">template</span><span class="o">.</span>
  <span class="o">--</span><span class="n">template</span> <span class="p">{</span><span class="n">job</span><span class="p">,</span><span class="n">job_batch</span><span class="p">,</span><span class="n">playbook</span><span class="p">,</span><span class="n">playbook_actions</span><span class="p">,</span><span class="n">playbook_utility</span><span class="p">}</span>
                        <span class="n">Choose</span> <span class="n">an</span> <span class="n">appropriate</span> <span class="n">App</span> <span class="n">template</span> <span class="k">for</span> <span class="n">the</span> <span class="n">current</span>
                        <span class="n">project</span><span class="o">.</span>
  <span class="o">--</span><span class="n">force</span>               <span class="n">Enable</span> <span class="n">this</span> <span class="n">flag</span> <span class="n">to</span> <span class="n">forcibly</span> <span class="n">overwrite</span> <span class="n">existing</span> <span class="n">files</span>
                        <span class="ow">in</span> <span class="n">the</span> <span class="n">current</span> <span class="n">working</span> <span class="n">directory</span><span class="o">.</span>
</pre></div>
</div>
<div class="section" id="common-usage">
<h4>Common Usage<a class="headerlink" href="#common-usage" title="Permalink to this headline">¶</a></h4>
<p>To initialize a new App run this command from the project directory.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcinit</span> <span class="o">--</span><span class="n">template</span> <span class="n">playbook_utility</span>
</pre></div>
</div>
<p>To update an existing App run this command from the project directory. The <strong>update</strong> action will download all frameworks files to ensure these files are the latest with any bug fixes or updates.  It is best practice to run the <strong>update</strong> action whenever an App is being updated for new features or bug fixes.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcinit</span> <span class="o">--</span><span class="n">action</span> <span class="n">update</span> <span class="o">--</span><span class="n">template</span> <span class="n">playbook_utility</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="job-app-templates">
<h3>Job App Templates<a class="headerlink" href="#job-app-templates" title="Permalink to this headline">¶</a></h3>
<div class="section" id="job-job">
<h4>Job (job)<a class="headerlink" href="#job-job" title="Permalink to this headline">¶</a></h4>
<p>This basic template provides the structure for a Job App without any logic.  This template is intended for advanced users that only require the App structure.</p>
</div>
<div class="section" id="job-ingress-job-ingress">
<h4>Job Ingress (job_ingress)<a class="headerlink" href="#job-ingress-job-ingress" title="Permalink to this headline">¶</a></h4>
<p>This template provides a working example of downloading remote threat intel (md5 hash indicators) and writing the data in the ThreatConnect Platform using the tcex batch module.</p>
</div>
</div>
<div class="section" id="playbook-app-templates">
<h3>Playbook App Templates<a class="headerlink" href="#playbook-app-templates" title="Permalink to this headline">¶</a></h3>
<div class="section" id="playbook-playbook">
<h4>Playbook (playbook)<a class="headerlink" href="#playbook-playbook" title="Permalink to this headline">¶</a></h4>
<p>This template provides the structure for a Playbook App without any logic.  This template is intended for advanced users that only require the App structure.</p>
</div>
<div class="section" id="playbook-action-playbook-action">
<h4>Playbook Action (playbook_action)<a class="headerlink" href="#playbook-action-playbook-action" title="Permalink to this headline">¶</a></h4>
<p>This template provides a working example of “actions” in a Playbook App. Using the “actions” feature a single Playbook can have multiple actions to perform different operations on the provided data.</p>
</div>
<div class="section" id="playbook-utility-playbook-utility">
<h4>Playbook Utility (playbook_utility)<a class="headerlink" href="#playbook-utility-playbook-utility" title="Permalink to this headline">¶</a></h4>
<p>This template provides a working example of a utility App that takes an input, analyzes or modifies the data, and writes the results as output.</p>
</div>
</div>
</div>
<div class="section" id="build-dependencies-tclib">
<h2>Build Dependencies (tclib)<a class="headerlink" href="#build-dependencies-tclib" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building-apps-dependencies">
<span id="id3"></span><h3>Summary<a class="headerlink" href="#building-apps-dependencies" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">tclib</span></code> CLI tool provides a simple interface to download required Python modules in a self contained folder in the project directory.  This “lib” directory allows all dependencies to be bundled within the App. The App dependencies should be defined in the <strong>requirements.txt</strong> file in the project directory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you are using <strong>macOS</strong> and have Python installed via Homebrew, there is a <a class="reference external" href="https://stackoverflow.com/questions/24257803/distutilsoptionerror-must-supply-either-home-or-prefix-exec-prefix-not-both">known bug</a> that requires you to create a <code class="docutils literal"><span class="pre">setup.cfg</span></code> file in the same directory as the <code class="docutils literal"><span class="pre">requirements.txt</span></code>. The <code class="docutils literal"><span class="pre">setup.cfg</span></code> file should have the following code at minimum:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">install</span><span class="p">]</span>
<span class="n">prefix</span><span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Usage<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>To get the latest usage for <code class="docutils literal"><span class="pre">tclib</span></code> run <code class="docutils literal"><span class="pre">tclib</span> <span class="pre">-h</span></code>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Running the <code class="docutils literal"><span class="pre">tcinit</span></code> command overwrites any existing lib directory.</p>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tclib</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">app_name</span> <span class="n">APP_NAME</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">app_path</span> <span class="n">APP_PATH</span><span class="p">]</span>
             <span class="p">[</span><span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">no_cache_dir</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">branch</span> <span class="n">BRANCH</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">app_name</span> <span class="n">APP_NAME</span>  <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">Fully</span> <span class="n">qualified</span> <span class="n">path</span> <span class="n">of</span> <span class="n">App</span><span class="o">.</span>
  <span class="o">--</span><span class="n">app_path</span> <span class="n">APP_PATH</span>  <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">Fully</span> <span class="n">qualified</span> <span class="n">path</span> <span class="n">of</span> <span class="n">App</span><span class="o">.</span>
  <span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span>      <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">Configuration</span> <span class="n">file</span> <span class="k">for</span> <span class="n">gen</span> <span class="n">lib</span><span class="o">.</span> <span class="p">(</span><span class="n">Default</span><span class="p">:</span>
                       <span class="n">tcex</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
  <span class="o">--</span><span class="n">no_cache_dir</span>       <span class="n">Do</span> <span class="ow">not</span> <span class="n">use</span> <span class="n">pip</span> <span class="n">cache</span> <span class="n">directory</span><span class="o">.</span>
  <span class="o">--</span><span class="n">branch</span> <span class="n">BRANCH</span>      <span class="n">Build</span> <span class="n">tcex</span> <span class="kn">from</span> <span class="nn">specified</span> <span class="n">git</span> <span class="n">branch</span> <span class="n">instead</span> <span class="n">of</span>
                       <span class="n">downloading</span> <span class="kn">from</span> <span class="nn">PyPi.</span>
</pre></div>
</div>
<div class="section" id="id5">
<h4>Common Usage<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>To build the “lib” directory for the current project the following is the most common command. This command can also be used to add/remove an changes made to requirements.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tclib</span>
</pre></div>
</div>
<p>If using a PIP cache it is sometimes required to tell <code class="docutils literal"><span class="pre">pip</span></code> to ignore the cached to pick up the latest package from pypi. Adding the <code class="docutils literal"><span class="pre">--no_cache_dir</span></code> flag to the command will force <code class="docutils literal"><span class="pre">tclib</span></code> to ignore any local cache directory.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tclib</span> <span class="o">--</span><span class="n">no_cache_dir</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-configuration-file">
<h3>Using Configuration File<a class="headerlink" href="#using-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>By default the <strong>tcex.json</strong> configuration file will be loaded if it exists.  If the configuration includes the <code class="docutils literal"><span class="pre">lib_versions</span></code> parameter array the <code class="docutils literal"><span class="pre">tclib</span></code> command will use the values defined in the configuration to build the lib directories.</p>
<p><strong>Linux</strong></p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;...</span><span class="n">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;lib_versions&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_2.7.13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.pyenv/versions/2.7.13/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_3.4.6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.pyenv/versions/3.4.6/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_3.5.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.pyenv/versions/3.5.3/bin/python&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_3.6.5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.pyenv/versions/3.6.5/bin/python&quot;</span>
  <span class="p">}</span>
<span class="p">],</span>
<span class="o">&lt;</span><span class="n">snipped</span><span class="o">...&gt;</span>
</pre></div>
</div>
<p>For ease of management when building multiple Apps the tcex.json file can contain environment vars defining the Python version (e.g., $env.PY36 for <code class="docutils literal"><span class="pre">export</span> <span class="pre">PY36='3.6.5'</span></code>).</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;...</span><span class="n">snipped</span><span class="o">&gt;</span>
  <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_$env.PY36&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.pyenv/versions/$env.PY36/bin/python&quot;</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="n">snipped</span><span class="o">...&gt;</span>
</pre></div>
</div>
<p><strong>Windows</strong></p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;...</span><span class="n">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;lib_versions&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_2.7.13&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~</span><span class="se">\\</span><span class="s2">AppData</span><span class="se">\\</span><span class="s2">Local</span><span class="se">\\</span><span class="s2">Programs</span><span class="se">\\</span><span class="s2">Python</span><span class="se">\\</span><span class="s2">Python27</span><span class="se">\\</span><span class="s2">python.exe&quot;</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;lib_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;lib_3.6.5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python_executable&quot;</span><span class="p">:</span> <span class="s2">&quot;~</span><span class="se">\\</span><span class="s2">AppData</span><span class="se">\\</span><span class="s2">Local</span><span class="se">\\</span><span class="s2">Programs</span><span class="se">\\</span><span class="s2">Python</span><span class="se">\\</span><span class="s2">Python36</span><span class="se">\\</span><span class="s2">python.exe&quot;</span>
  <span class="p">}</span>
<span class="p">],</span>
<span class="o">&lt;</span><span class="n">snipped</span><span class="o">...&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-test-profiles-tcprofile">
<h2>Creating Test Profiles (tcprofile)<a class="headerlink" href="#creating-test-profiles-tcprofile" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-profiles">The <code class="docutils literal"><span class="pre">tcprofile</span></code> CLI tool provides a simple interface to create testing profiles.  These profiles can be used to perform local testing of the App before deploying to ThreatConnect.  Multiple profiles can be create and grouped to allow testing of different data inputs and outputs.</p>
<p>By default the <code class="docutils literal"><span class="pre">tcprofile</span></code> command will add any default values defined in the <strong>install.json</strong> file to the args value.  Args without a default value will have to populated manually. For validation rules there are 2 rules created automatically for each output variables.  One rule ensures that the output variable is not null and should be update to a more specific test. The second rule validates that the output variables is of the correct type (e.g., String value is a &lt;str&gt; type, StringArray value is of &lt;list&gt; type.).</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The generation of profiles uses the <strong>install.json</strong> file to create the <code class="docutils literal"><span class="pre">args.apps</span></code> section and the <code class="docutils literal"><span class="pre">validation</span></code> section of the profile. It is important that all inputs and outputs are defined in the <strong>install.json</strong> prior to running the <code class="docutils literal"><span class="pre">tcprofile</span></code> command.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A local instance of Redis must be running to test Playbook Apps locally.</p>
</div>
<div class="section" id="id6">
<h3>Usage<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tcprofile</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">action</span> <span class="p">{</span><span class="n">create</span><span class="p">,</span><span class="n">delete</span><span class="p">,</span><span class="n">replace_validation</span><span class="p">,</span><span class="n">update</span><span class="p">,</span><span class="n">validate</span><span class="p">}]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">ij</span> <span class="n">IJ</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outfile</span> <span class="n">OUTFILE</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">profile_name</span> <span class="n">PROFILE_NAME</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">redis_host</span> <span class="n">REDIS_HOST</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">redis_port</span> <span class="n">REDIS_PORT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">verbose</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">action</span> <span class="p">{</span><span class="n">create</span><span class="p">,</span><span class="n">delete</span><span class="p">,</span><span class="n">replace_validation</span><span class="p">,</span><span class="n">update</span><span class="p">,</span><span class="n">validate</span><span class="p">}</span>
  <span class="o">--</span><span class="n">ij</span> <span class="n">IJ</span>               <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">The</span> <span class="n">install</span><span class="o">.</span><span class="n">json</span> <span class="n">file</span> <span class="n">name</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span>
                        <span class="n">install</span><span class="o">.</span><span class="n">json</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span>       <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">The</span> <span class="o">*</span><span class="n">base</span><span class="o">*</span> <span class="n">output</span> <span class="n">directory</span> <span class="n">containing</span> <span class="n">the</span>
                        <span class="n">data</span><span class="o">/</span><span class="n">profiles</span> <span class="n">folder</span><span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">tcex</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">outfile</span> <span class="n">OUTFILE</span>     <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">The</span> <span class="n">filename</span> <span class="k">for</span> <span class="n">the</span> <span class="n">profile</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span>
                        <span class="o">&lt;</span><span class="n">profile</span> <span class="n">name</span><span class="o">&gt;.</span><span class="n">json</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">name</span> <span class="n">PROFILE_NAME</span>   <span class="n">The</span> <span class="n">profile</span> <span class="n">name</span> <span class="n">to</span> <span class="n">create</span><span class="p">,</span> <span class="n">delete</span><span class="p">,</span> <span class="ow">or</span>
                        <span class="n">replace_validation</span><span class="o">.</span>
  <span class="o">--</span><span class="n">redis_host</span> <span class="n">REDIS_HOST</span>
                        <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">The</span> <span class="n">redis</span> <span class="n">host</span><span class="o">.</span>
  <span class="o">--</span><span class="n">redis_port</span> <span class="n">REDIS_PORT</span>
                        <span class="p">(</span><span class="n">Advanced</span><span class="p">)</span> <span class="n">The</span> <span class="n">redis</span> <span class="n">port</span><span class="o">.</span>
  <span class="o">--</span><span class="n">verbose</span>             <span class="n">Show</span> <span class="n">verbose</span> <span class="n">output</span><span class="o">.</span>
</pre></div>
</div>
<div class="section" id="id7">
<h4>Common Usage<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>To create a new profile run the following command.  The profile will be created in the <strong>tcex.d/profiles</strong> directory of the project.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">tcprofile</span> <span class="o">--</span><span class="n">name</span> <span class="n">simple_data</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">tcprofile</span></code> command can be run multiple times to generate several different profiles with different input and/or output variables.</p>
</div>
</div>
</div>
<div class="section" id="profile-format">
<h3>Profile Format<a class="headerlink" href="#profile-format" title="Permalink to this headline">¶</a></h3>
<p>Multiple testing profiles can be created in the <strong>tcex.d/profiles</strong> directory to increase testing coverage.  Each profile must include a unique <strong>profile_name</strong>. One or more groups can be added to a profile to allow testing of multiple profiles at once.</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;json_data&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">four</span><span class="se">\&quot;</span><span class="s2">: 5, </span><span class="se">\&quot;</span><span class="s2">one</span><span class="se">\&quot;</span><span class="s2">: 1, </span><span class="se">\&quot;</span><span class="s2">two</span><span class="se">\&quot;</span><span class="s2">: 2, </span><span class="se">\&quot;</span><span class="s2">three</span><span class="se">\&quot;</span><span class="s2">: 3}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sort_keys&quot;</span><span class="p">:</span> <span class="n">true</span>
      <span class="p">},</span>
      <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;api_access_id&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.API_ACCESS_ID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_default_org&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.API_DEFAULT_ORG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_secret_key&quot;</span><span class="p">:</span> <span class="s2">&quot;$envs.API_SECRET_KEY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_api_path&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_API_PATH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_docker&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;tc_in_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_log_level&quot;</span><span class="p">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_log_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_log_to_api&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;tc_out_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="p">:</span> <span class="s2">&quot;c723fe88-d4bb-40db-8a98-bdec323e6190&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.DB_PATH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.DB_PORT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_playbook_out_variables&quot;</span><span class="p">:</span> <span class="s2">&quot;#App:7909:json.pretty!String&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_external&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_host&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_PROXY_HOST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_password&quot;</span><span class="p">:</span> <span class="s2">&quot;$envs.TC_PROXY_PASSWORD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_port&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_PROXY_PORT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_tc&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;tc_proxy_username&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_PROXY_USERNAME&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tc_temp_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;autoclear&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;clear&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;data_files&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;exit_codes&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="mi">0</span>
    <span class="p">],</span>
    <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;qa-build&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;install_json&quot;</span><span class="p">:</span> <span class="s2">&quot;install.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="s2">&quot;simple_data&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;validations&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;four&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
          <span class="s2">&quot;one&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s2">&quot;three&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s2">&quot;two&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;json-compare&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;#App:7909:json.pretty!String&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;#App:7909:json.pretty!String&quot;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="args-app">
<h4>args.app<a class="headerlink" href="#args-app" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">args.app</span></code> section of the profile contains all the CLI Args from the <code class="docutils literal"><span class="pre">params</span></code> section of the <strong>install.json</strong> file.</p>
</div>
<div class="section" id="args-default">
<h4>args.default<a class="headerlink" href="#args-default" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">args.default</span></code> section has all the default args that are passed to all Apps by ThreatConnect. Some of these args are in the format <code class="docutils literal"><span class="pre">$env.&lt;value&gt;</span></code> or <code class="docutils literal"><span class="pre">$envs.&lt;value&gt;</span></code>. Args in this format reference environment variables defined on the local workstation. These environment variables must be created manually by the developer.  The <code class="docutils literal"><span class="pre">$envs.&lt;values&gt;</span></code> are used to represent sensitive data, such as API credentials and will be masked when printed to the screen.</p>
</div>
<div class="section" id="autoclear">
<h4>autoclear<a class="headerlink" href="#autoclear" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">autoclear</span></code> boolean field enables clearing of Redis and/or ThreatConnect data when set to <strong>true</strong>. By using autoclear the developer can assure that validation rules are not using stale data. The most common use case is to leave this enabled unless using output data from previous profiles.</p>
</div>
<div class="section" id="data-files">
<h4>data_files<a class="headerlink" href="#data-files" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">data_files</span></code> section of the configuration allow an array of staging files to be defined. Each staging file defined in this section will be staged to Redis and/or ThreatConnect to simulate an upstream App.  For help creating staging files see the <a class="reference internal" href="#id8">Data Files</a> section.</p>
</div>
<div class="section" id="description">
<h4>description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">description</span></code> field allows for a helpful message that will be logged when the profile is run (e.g., “Pass test of simple JSON data.” or “Fail test when passing in null data.”).</p>
</div>
<div class="section" id="exit-codes">
<h4>exit_codes<a class="headerlink" href="#exit-codes" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">exit_codes</span></code> section allows for one or more exit codes to be defined. If the exit code of the App matches one of the defined values then the profile was completed successfully. For “fail” testing adding an exit code of <strong>1</strong> is appropriate.  If the App exits with a <strong>1</strong> then the profile succeeded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Job Apps there are 3 valid exit codes.  An exit code of 0 indicates success, 1 indicates failure, and 3 indicates partial success/failure.</p>
</div>
</div>
<div class="section" id="groups">
<h4>groups<a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">groups</span></code> section allows for one or more group names so that the profile can be run grouped with other profiles.</p>
</div>
<div class="section" id="install-json">
<h4>install_json<a class="headerlink" href="#install-json" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">install_json</span></code> field defines the install.json filename of the App. This is typically <code class="docutils literal"><span class="pre">install.json</span></code> unless working in a Multi-App bundle.</p>
</div>
<div class="section" id="profile-name">
<h4>profile_name<a class="headerlink" href="#profile-name" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">profile_name</span></code> field defines the name of the profile.  This is the name that will be used to run the profile using the <code class="docutils literal"><span class="pre">tcrun</span></code> command.</p>
</div>
<div class="section" id="quiet">
<h4>quiet<a class="headerlink" href="#quiet" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">quiet</span></code> boolean field will silence all App output when set to <strong>true</strong>.</p>
</div>
<div class="section" id="validations">
<h4>validations<a class="headerlink" href="#validations" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">validations</span></code> section of the configuration file defines validations rules for testing Playbook App outputs.</p>
</div>
</div>
<div class="section" id="staging-redis-data">
<h3>Staging Redis Data<a class="headerlink" href="#staging-redis-data" title="Permalink to this headline">¶</a></h3>
<p>In order to test using variable inputs the data can be manually added to Redis.  The <code class="docutils literal"><span class="pre">tcrun</span></code> command has functionality to “stage” the data in redis that can be used to simulate an upstream App writing data to Redis.  This staged data can be and added to a single json file or multiple reusable files.  Once the files have been created they should be referenced in the Profile.</p>
</div>
<div class="section" id="id8">
<h3>Data Files<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data files can contain a single data input or multiple data inputs.  If the data is reusable it is best practice to keep the data in a file by itself so that it can be used in multiple profiles.</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[{</span>
  <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">125</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;threat001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Threat&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:45:42-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/threat/threat.xhtml?threat=125&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">124</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;incident001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Incident&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:44:57-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/incident/incident.xhtml?incident=124&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;doc001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:43:54-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/document/document.xhtml?document=123&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">122</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;camp001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Campaign&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:40:56-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/campaign/campaign.xhtml?campaign=122&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">116</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;adver001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Adversary&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:35:07-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/adversary/adversary.xhtml?adversary=116&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0022:groups!TCEntityArray&quot;</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="data-validation">
<h3>Data Validation<a class="headerlink" href="#data-validation" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">tcrun</span></code> command will run any validation rules defined in the profile. Currently the <code class="docutils literal"><span class="pre">tcrun</span></code> command can validate the output data store in Redis by the App.</p>
<p><strong>Example Configuration</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;validations&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;four&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;one&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;three&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;two&quot;</span><span class="o">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="s2">&quot;data_type&quot;</span><span class="o">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;json-compare&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:7909:json.pretty!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data_type&quot;</span><span class="o">:</span> <span class="s2">&quot;redis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:7909:json.pretty!String&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="supported-operators">
<h4>Supported Operators<a class="headerlink" href="#supported-operators" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>deep-diff (dd): This operator can compare any object that can be represented as JSON.</li>
<li>eq: This operator does a equal to comparison for String and StringArray variables.</li>
<li>ends-with (ew): This operator compares the end of a String with a user provided value.</li>
<li>ge: This operator does a greater than or equal to comparison for String variables.</li>
<li>gt: This operator does a greater than comparison for String variables.</li>
<li>json-compare (jc): This operator will convert a String output variable to a JSON object (dict) and compare to user provided data.</li>
<li>key-value-compare (kva): This operator will validate that key/value data is in KeyValueArray.</li>
<li>in: This operator will check to see if a String output variable is in an user provided array.</li>
<li>in-user-data: This operator will validate that user provided String value is in output StringArray variable.</li>
<li>not-in (ni): This operator will check to see if a String variable is <strong>not</strong> in an user provided array.</li>
<li>is-type (it): This operator will check to see if the variable “type” is equal to the user provided “type”.</li>
<li>le: This operator does a less than or equal to comparison for String variables.</li>
<li>lt: This operator does a less than comparison for String variables.</li>
<li>ne: This operator does a <strong>not</strong> equal to comparison for String and StringArray variables.</li>
<li>string-compare (se):</li>
<li>starts-with (sw): This operator compares the start of a String with a user provided value.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="running-test-profiles-tcrun">
<h2>Running Test Profiles (tcrun)<a class="headerlink" href="#running-test-profiles-tcrun" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-run">Apps are called from the ThreatConnect Platform using Command Line Interface Arguments or CLI Args.  To simulate being called from ThreatConnect the TcEx <code class="docutils literal"><span class="pre">tcrun</span></code> command provides a method for converting a defined JSON structure to CLI Args.  Running <code class="docutils literal"><span class="pre">tcrun</span></code> will read the <code class="docutils literal"><span class="pre">tcex.json</span></code> file and parse the <strong>args</strong> section from the <strong>default</strong> profile in the <code class="docutils literal"><span class="pre">profiles</span></code> parameter array.  To specify a different file the <code class="docutils literal"><span class="pre">--config</span></code> argument can be passed (e.g. <code class="docutils literal"><span class="pre">--config</span> <span class="pre">my_config.json</span></code>).  To run a specific profile the <code class="docutils literal"><span class="pre">--profile</span></code> argument can be passed (<code class="docutils literal"><span class="pre">--profile</span> <span class="pre">add-indicator</span></code>).  A group of profiles can also be run using the <code class="docutils literal"><span class="pre">--group</span></code> argument (e.g. <code class="docutils literal"><span class="pre">--group</span> <span class="pre">run-all</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When testing a single profile (use case) the <code class="docutils literal"><span class="pre">tcrun</span></code> command would be called using that profile.  Before packaging the App calling <code class="docutils literal"><span class="pre">tcrun</span></code> using a group that will run multiple profiles is typical.</p>
</div>
<div class="section" id="id9">
<h3>Usage<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tcrun</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">autoclear</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">halt_on_fail</span><span class="p">]</span>
             <span class="p">[</span><span class="o">--</span><span class="n">group</span> <span class="n">GROUP</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">logging_level</span> <span class="n">LOGGING_LEVEL</span><span class="p">]</span>
             <span class="p">[</span><span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">quiet</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">report</span> <span class="n">REPORT</span><span class="p">]</span>
             <span class="p">[</span><span class="o">--</span><span class="n">truncate</span> <span class="n">TRUNCATE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">unmask</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span>       <span class="n">The</span> <span class="n">configuration</span> <span class="n">file</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="s2">&quot;tcex.json&quot;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">autoclear</span>           <span class="n">Clear</span> <span class="n">Redis</span> <span class="n">data</span> <span class="n">before</span> <span class="n">running</span><span class="o">.</span>
  <span class="o">--</span><span class="n">halt_on_fail</span>        <span class="n">Halt</span> <span class="n">on</span> <span class="nb">any</span> <span class="n">failure</span><span class="o">.</span>
  <span class="o">--</span><span class="n">group</span> <span class="n">GROUP</span>         <span class="n">The</span> <span class="n">group</span> <span class="n">of</span> <span class="n">profiles</span> <span class="n">to</span> <span class="n">executed</span><span class="o">.</span>
  <span class="o">--</span><span class="n">logging_level</span> <span class="n">LOGGING_LEVEL</span>
                        <span class="n">The</span> <span class="n">logging</span> <span class="n">level</span><span class="o">.</span>
  <span class="o">--</span><span class="n">profile</span> <span class="n">PROFILE</span>     <span class="n">The</span> <span class="n">profile</span> <span class="n">to</span> <span class="n">be</span> <span class="n">executed</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">quiet</span>               <span class="n">Suppress</span> <span class="n">output</span><span class="o">.</span>
  <span class="o">--</span><span class="n">report</span> <span class="n">REPORT</span>       <span class="n">The</span> <span class="n">JSON</span> <span class="n">report</span> <span class="n">filename</span><span class="o">.</span>
  <span class="o">--</span><span class="n">truncate</span> <span class="n">TRUNCATE</span>   <span class="n">The</span> <span class="n">length</span> <span class="n">at</span> <span class="n">which</span> <span class="n">to</span> <span class="n">truncate</span> <span class="n">successful</span> <span class="n">validation</span>
                        <span class="n">data</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">logs</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">unmask</span>              <span class="n">Unmask</span> <span class="n">masked</span> <span class="n">args</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Profile Format<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Multiple testing profiles can be defined in the <strong>tcex.json</strong> to help testing coverage.  Each profile should include a unique <strong>profile_name</strong> and a group which allows for running multiple profiles at once.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">tcrun</span></code> command provides a feature that allow using environment variables in the <strong>tcex.json</strong> configuration file.  By prefixing the environment variable with <strong>$env.</strong> or <strong>$envs.</strong> the <code class="docutils literal"><span class="pre">tcrun</span></code> command will pull the value from the OS Environment variable. This feature helps facilitate quickly changing values between testing environments and/or user credentials.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">To protect credentials in the <strong>tcex.json</strong> configuration file the <strong>$envs.</strong> feature should be used.  This will keep the credentials out of version control and will mask them on command output.  To unmask the credentials temporarily the <code class="docutils literal"><span class="pre">--unmask</span></code> command can be passed to <code class="docutils literal"><span class="pre">tcrun</span></code>.</p>
</div>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;profiles&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;api_access_id&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_ACCESS_ID&quot;</span><span class="p">,</span>
      <span class="s2">&quot;api_secret_key&quot;</span><span class="p">:</span> <span class="s2">&quot;$envs.TC_SECRET_KEY&quot;</span><span class="p">,</span>
      <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_api_path&quot;</span><span class="p">:</span> <span class="s2">&quot;$env.TC_API_PATH&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_log_to_api&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_out_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="p">:</span> <span class="s2">&quot;7960ab08-26cb-4140-abb9-9310bb45ac86&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="p">:</span> <span class="s2">&quot;6379&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_host&quot;</span><span class="p">:</span> <span class="s2">&quot;10.10.10.10&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_port&quot;</span><span class="p">:</span> <span class="s2">&quot;3128&quot;</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_external&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_proxy_tc&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;tc_temp_path&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
      <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;#App:1234:slack-string!String&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_api_token&quot;</span><span class="p">:</span> <span class="s2">&quot;$envs.SLACK_API_TOKEN&quot;</span><span class="p">,</span>
      <span class="s2">&quot;slack_recipient&quot;</span><span class="p">:</span> <span class="s2">&quot;@bob&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;run-all&quot;</span><span class="p">],</span>
    <span class="s2">&quot;install_json&quot;</span><span class="p">:</span> <span class="s2">&quot;install.json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;profile_name&quot;</span><span class="p">:</span> <span class="s2">&quot;send-slack-message&quot;</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>args</strong> section should contain all the CLI Args your app requires to run. The <strong>groups</strong> section defines which groups this profile should run under and the <strong>profile_name</strong> is the name which can be used to run the profile.  The <strong>quiet</strong> field indicates whether the app should print output.</p>
</div>
</div>
<div class="section" id="profile-creation">
<h3>Profile Creation<a class="headerlink" href="#profile-creation" title="Permalink to this headline">¶</a></h3>
<p>The TcEx framework provides the <code class="docutils literal"><span class="pre">tcprofile</span></code> command to automatically generate a profile from the install.json file.  The output of the <code class="docutils literal"><span class="pre">tcprofile</span></code> command will set the exit_code to 0 by default, however testing failure scenarios is also possible by setting the exit code to 1. Some default values will be added to the args section, but any custom inputs will need to be populated with the appropriate data.</p>
<p>For playbook Apps the <code class="docutils literal"><span class="pre">tcprofile</span></code> command will also create 2 standard validations for each output variable.  The first validation will check to see if the output variable is <strong>null</strong> and the second will ensure the output variables is the correct type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">tcprofile</span></code> command can be run multiple times to generate several different profiles with different input and/or output variables.</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>usage: tcprofile <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--action <span class="o">{</span>create,delete,replace_validation,update<span class="o">}]</span>
                 <span class="o">[</span>--ij IJ<span class="o">]</span> <span class="o">[</span>--data_file<span class="o">]</span> <span class="o">[</span>--outdir OUTDIR<span class="o">]</span> <span class="o">[</span>--outfile OUTFILE<span class="o">]</span>
                 --profile_name PROFILE_NAME <span class="o">[</span>--redis_hash REDIS_HASH<span class="o">]</span>
                 <span class="o">[</span>--redis_host REDIS_HOST<span class="o">]</span> <span class="o">[</span>--redis_port REDIS_PORT<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --action <span class="o">{</span>create,delete,replace_validation,update<span class="o">}</span>
  --ij IJ               The install.json file name <span class="o">(</span>default: install.json<span class="o">)</span>.
  --data_file           Attempt to build data file templates <span class="k">for</span> the profile.
  --outdir OUTDIR       The *base* output directory containing the
                        data/profiles folder.
  --outfile OUTFILE     The name of the file to write the profile.
  --profile_name PROFILE_NAME
                        The profile name to create, delete, or update.
  --redis_hash REDIS_HASH
                        The redis hash.
  --redis_host REDIS_HOST
                        The redis host.
  --redis_port REDIS_PORT
                        The redis port.
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>Staging Redis Data<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A local instance of Redis must be running to test Playbook Apps locally.</p>
</div>
<p>In order to test using variable inputs the data can be manually added to Redis.  The <code class="docutils literal"><span class="pre">tcrun</span></code> command has functionality to “stage” the data in redis that can be used to simulate an upstream App writing data to Redis.  This staged data can be and added to a single json file or multiple reusable files.  Once the files have been created they should be referenced in the Profile.</p>
</div>
<div class="section" id="example-data-file">
<h3>Example Data File<a class="headerlink" href="#example-data-file" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data files can contain a single data input or multiple data inputs.  In most cases it better to have separate files so the data can be reused in multiple Profiles.</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[{</span>
  <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">125</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;threat001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Threat&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:45:42-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/threat/threat.xhtml?threat=125&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">124</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;incident001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Incident&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:44:57-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/incident/incident.xhtml?incident=124&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;doc001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Document&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:43:54-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/document/document.xhtml?document=123&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">122</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;camp001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Campaign&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:40:56-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/campaign/campaign.xhtml?campaign=122&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">116</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;adver001-build-testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;Adversary&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ownerName&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dateAdded&quot;</span><span class="o">:</span> <span class="s2">&quot;2017-08-16T18:35:07-04:00&quot;</span><span class="p">,</span>
      <span class="s2">&quot;webLink&quot;</span><span class="o">:</span> <span class="s2">&quot;https://mytc.myorg.com/auth/adversary/adversary.xhtml?adversary=116&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0022:groups!TCEntityArray&quot;</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="profile-with-data-file">
<h3>Profile with Data File<a class="headerlink" href="#profile-with-data-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[{</span>
  <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;api_access_id&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.API_ACCESS_ID&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_secret_key&quot;</span><span class="o">:</span> <span class="s2">&quot;$envs.API_SECRET_KEY&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logging&quot;</span><span class="o">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_api_path&quot;</span><span class="o">:</span> <span class="s2">&quot;$env.TC_API_PATH&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_log_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_log_to_api&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;tc_out_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_temp_path&quot;</span><span class="o">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Redis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_context&quot;</span><span class="o">:</span> <span class="s2">&quot;1860ab08-26cb-4140-abb9-9310bb45ac86&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_path&quot;</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_db_port&quot;</span><span class="o">:</span> <span class="s2">&quot;6379&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tc_playbook_out_variables&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0072:tc.tag.fail_count!String,#App:0072:tc.tag.success_count!String,#App:0072:tc.tag.tags!StringArray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;entity&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:0022:groups!TCEntityArray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tag&quot;</span><span class="o">:</span> <span class="s2">&quot;QaTagCreate&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;data_files&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;tcex.d/data/groups.json&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Pass test of create tag.&quot;</span><span class="p">,</span>
  <span class="s2">&quot;group&quot;</span><span class="o">:</span> <span class="s2">&quot;qa-build&quot;</span><span class="p">,</span>
  <span class="s2">&quot;profile_name&quot;</span><span class="o">:</span> <span class="s2">&quot;create-tag-on-groups&quot;</span><span class="p">,</span>
  <span class="s2">&quot;quiet&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;script&quot;</span><span class="o">:</span> <span class="s2">&quot;tc_tag&quot;</span><span class="p">,</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>Data Validation<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">tcrun</span></code> command provides some basic data validation for output variables.  By defining the <strong>validations</strong> parameter array in the <strong>tcex.json</strong> file the <code class="docutils literal"><span class="pre">tcrun</span></code> command will pull the values from the REDIS DB and perform the provided operator on the data. This action simulates a downstream App reading the data from REDIS.</p>
<p><strong>Example Configuration</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;validations&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.success_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.success_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.fail_count!String&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;operator&quot;</span><span class="o">:</span> <span class="s2">&quot;it&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="s2">&quot;#App:1073:tc.association.fail_count!String&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Supported Operators</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s1">&#39;eq&#39;</span> <span class="c1"># equal to</span>
<span class="s1">&#39;ew&#39;</span> <span class="c1"># ends with</span>
<span class="s1">&#39;ge&#39;</span> <span class="c1"># greater than or equal to</span>
<span class="s1">&#39;gt&#39;</span> <span class="c1"># greater than</span>
<span class="s1">&#39;in&#39;</span> <span class="c1"># in array</span>
<span class="s1">&#39;ni&#39;</span> <span class="c1"># not in array</span>
<span class="s1">&#39;it&#39;</span> <span class="c1"># is type (array, binary, entity, string)</span>
<span class="s1">&#39;lt&#39;</span> <span class="c1"># less than</span>
<span class="s1">&#39;le&#39;</span> <span class="c1"># less than or equal to</span>
<span class="s1">&#39;ne&#39;</span> <span class="c1"># not equal</span>
<span class="s1">&#39;sw&#39;</span> <span class="c1"># start with</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>Exit Codes<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">tcrun</span></code> command can validate the exit code of the App.  This allows for setting up fail scenarios profiles.  All Apps should exit with a valid exit code and handle failures gracefully.  Using the exit_codes parameter you can provide “bad” data to the App and ensure it exits with the proper exit code.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;exit_codes&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Runtime/Job Apps (non Playbook Apps) valid exit codes are 0, 1, and 3.  For certain profiles you may expect an exit code of 0 for success or 3 for partial success/partial failure.  This can be achieved by adding both status codes to the <strong>exit_codes</strong> parameter array.</p>
</div>
</div>
</div>
<div class="section" id="packaging-an-app-tcpackage">
<h2>Packaging an App (tcpackage)<a class="headerlink" href="#packaging-an-app-tcpackage" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-package">Running <code class="docutils literal"><span class="pre">tcpackage</span></code> will build a zip package of your App that can be installed directly in the ThreatConnect Platform.  For Apps packages that contain multiple Apps using separate <strong>install.json</strong> files add the <code class="docutils literal"><span class="pre">--bundle</span></code> argument to build a bundle.  When using multiple <strong>install.json</strong> files the prefix of the filename is the App name (e.g. MyApp.install.json will have an App name of <strong>MyApp</strong>).  During the build process validation of the <strong>install.json</strong> file will be handled automatically if the <strong>tcex_json_schema.json</strong> schema file is included in the base directory of your App.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Typically the <code class="docutils literal"><span class="pre">tcpackage</span></code> command would be run with no arguments or using the <code class="docutils literal"><span class="pre">--bundle</span></code> flag for packages with multiple install.json files.</p>
</div>
<div class="section" id="id14">
<h3>Usage<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">tcpackage</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">bundle</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">exclude</span> <span class="n">EXCLUDE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">install_json</span> <span class="n">INSTALL_JSON</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">bundle</span>              <span class="n">Build</span> <span class="n">a</span> <span class="n">bundle</span> <span class="n">file</span><span class="o">.</span>
  <span class="o">--</span><span class="n">exclude</span> <span class="n">EXCLUDE</span>     <span class="n">File</span> <span class="ow">and</span> <span class="n">directories</span> <span class="n">to</span> <span class="n">exclude</span> <span class="kn">from</span> <span class="nn">build.</span>
  <span class="o">--</span><span class="n">config</span> <span class="n">CONFIG</span>       <span class="n">Build</span> <span class="n">configuration</span> <span class="n">file</span><span class="o">.</span> <span class="p">(</span><span class="n">Default</span><span class="p">:</span> <span class="n">tcex</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
  <span class="o">--</span><span class="n">install_json</span> <span class="n">INSTALL_JSON</span>
                        <span class="n">The</span> <span class="n">install</span><span class="o">.</span><span class="n">json</span> <span class="n">file</span> <span class="n">name</span> <span class="k">for</span> <span class="n">the</span> <span class="n">App</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span>
                        <span class="n">built</span><span class="o">.</span>
  <span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span>       <span class="n">Directory</span> <span class="n">to</span> <span class="n">write</span> <span class="n">the</span> <span class="n">outfile</span><span class="o">.</span> <span class="p">(</span><span class="n">Default</span><span class="p">:</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-options">
<h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h3>
<p>By default the <code class="docutils literal"><span class="pre">tcex.json</span></code> file will be loaded by <code class="docutils literal"><span class="pre">tcpackage</span></code>.  The following is an example of additional configuration that can be provided for the <code class="docutils literal"><span class="pre">tcpackage</span></code> command.</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;..</span><span class="n">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;package&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MyApp&quot;</span><span class="p">,</span>
  <span class="s2">&quot;app_version&quot;</span><span class="p">:</span> <span class="s2">&quot;v1.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;bundle&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
  <span class="s2">&quot;excludes&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tcex.d&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;outdir&quot;</span><span class="p">:</span> <span class="s2">&quot;target&quot;</span>
<span class="p">},</span>
<span class="o">&lt;</span><span class="n">snipped</span><span class="o">..&gt;</span>
</pre></div>
</div>
<p><strong>Multiple Bundles</strong></p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;..</span><span class="n">snipped</span><span class="o">&gt;</span>
<span class="s2">&quot;package&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">&quot;bundle&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
  <span class="s2">&quot;bundle_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TCPB_-_Palo_Alto&quot;</span><span class="p">,</span>
  <span class="s2">&quot;bundle_packages&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TCPB_-_My_Bundle_Create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;patterns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;.*Create.*&quot;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TCPB_-_My_Bundle_Delete&quot;</span><span class="p">,</span>
    <span class="s2">&quot;patterns&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;.*Delete.*&quot;</span>
    <span class="p">]</span>
  <span class="p">}],</span>
  <span class="s2">&quot;excludes&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tcex.d&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;outdir&quot;</span><span class="p">:</span> <span class="s2">&quot;target&quot;</span>
<span class="p">},</span>
<span class="o">&lt;</span><span class="n">snipped</span><span class="o">..&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="app-directory-structure">
<h2>App Directory Structure<a class="headerlink" href="#app-directory-structure" title="Permalink to this headline">¶</a></h2>
<p id="building-apps-structure">This guide is for written for development on a OSX or Linux system.  Development on a Windows system should follow similar steps.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This guide assumes that the workstation and ThreatConnect instance have the same version of Python installed. Writing Apps that support multiple versions of Python is supported but not covered in this quickstart.</p>
</div>
<div class="section" id="id15">
<h3>Initializing an App<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">TCPB_</span><span class="o">-</span><span class="n">_JsonPretty</span>
<span class="n">cd</span> <span class="n">TCPB_</span><span class="o">-</span><span class="n">_JsonPretty</span>
<span class="n">tcinit</span> <span class="o">--</span><span class="n">action</span> <span class="n">create</span> <span class="o">--</span><span class="n">template</span> <span class="n">playbook_utility</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">

           </div>
          </div>
          <footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">

        <a href="data_filter.html" class="btn btn-neutral float-right" title="Data Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>


        <a href="batch.html" class="btn btn-neutral" title="Batch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, ThreatConnect Inc.

    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>





    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>





    <script type="text/javascript" src="_static/js/theme.js"></script>




  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>


</body>
</html>
